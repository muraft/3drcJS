!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Tdrc=t():e.Tdrc=t()}(self,(()=>(()=>{var e={692:e=>{e.exports=class{constructor(){this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.faceLeft=!1,this.faceRight=!1}keyboard(e="default"){"default"==e&&(window.onkeydown=e=>{switch(e.keyCode){case 37:case 65:buttons.left=!0;break;case 38:case 68:buttons.right=!0;break;case 39:case 87:buttons.forward=!0;break;case 40:case 83:buttons.backward=!0;break;case 81:buttons.faceLeft=!0;break;case 69:buttons.faceRight=!0}},window.onkeyup=e=>{switch(e.keyCode){case 37:case 65:buttons.left=!1;break;case 38:case 68:buttons.right=!1;break;case 39:case 87:buttons.forward=!1;break;case 40:case 83:buttons.backward=!1;break;case 81:buttons.faceLeft=!1;break;case 69:buttons.faceRight=!1}})}}},961:(e,t,a)=>{var r={"./Buttons":692,"./Buttons.js":692};function s(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=o,e.exports=s,s.id=961},864:(e,t,a)=>{const{loadDefault:r,loadMethods:s,loadClasses:o}=a(330),i=a(848),{validate:l}=a(162);"undefined"!=typeof window?o(["Buttons"]):console.warn("[33m%s[0m","Application runned outside the browser, window is not found, the global class won't load"),e.exports=class{constructor(){r(this),s(this,["set","control","run","render"])}init(){l(this.map,["data"],"map"),l(this.player,["x","y"],"player"),i(this)}}},599:(e,t,a)=>{const{toRadian:r}=a(162);e.exports={map:{cellSize:5},texture:{colour:"blue",data:{}},player:{size:1,angle:r(45),speed:.05},graphic:{totalRay:300,fov:r(45),rayStep:.05,texture:!0,depth:!0},rays:[],_deltaTime:0,fps:0,devMode:!1}},330:(e,t,a)=>{const r=a(599);e.exports={loadDefault:e=>Object.assign(e,r),loadMethods:(e,t)=>{t.forEach((t=>{const r=a(193)("./"+t);if("object"==typeof r)for(const t in r)e[t]=r[t];else e[t]=r}))},loadClasses:e=>{e.forEach((e=>window["Tdrc_"+e]=a(961)("./"+e)))}}},681:(e,t,a)=>{const{toRadian:r}=a(162),{moveX:s,moveY:o}=a(325);e.exports=function(e){if(e.left){let e=this.player.angle-r(90),t=this.player.speed*Math.cos(e),a=this.player.speed*Math.sin(e);s(this,t),o(this,a)}if(e.forward){let e=this.player.speed*Math.cos(this.player.angle),t=this.player.speed*Math.sin(this.player.angle);s(this,e),o(this,t)}if(e.right){let e=this.player.angle+r(90),t=this.player.speed*Math.cos(e),a=this.player.speed*Math.sin(e);s(this,t),o(this,a)}if(e.backward){let e=this.player.speed*Math.cos(this.player.angle),t=this.player.speed*Math.sin(this.player.angle);s(this,-e),o(this,-t)}e.faceLeft&&(this.player.angle-=r(1)),e.faceRight&&(this.player.angle+=r(1))}},963:(e,t,a)=>{const r=a(140),s=a(629);e.exports=function(e){const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),this.player.xPos=this.player.x*this.map.cellSize,this.player.yPos=this.player.y*this.map.cellSize,this.rays=r(this),this.devMode&&console.log(this.rays),s(this,this.rays,e,t)}},465:e=>{let t,a,r;function s(){r=performance.now(),a(),t._deltaTime=performance.now()-r,t.fps=1e3/t._deltaTime,requestAnimationFrame(s)}e.exports=function(e){t=this,a=e,window.onload=()=>requestAnimationFrame(s)}},902:(e,t,a)=>{const{assign:r,validate:s,toRadian:o}=a(162);e.exports={setMap:function(e){Object.assign(this.map,e),s(this.map,["data"],"map");let t=Math.sqrt(this.map.data.length);if(t%1!=0)throw new Error("Only nÃ—n square map is supported");this.map.side=t,this.map.distance=this.map.side*this.map.cellSize-2*this.map.cellSize},setGraphic:function(e){e.hasOwnProperty("fov")&&(e.fov=o(e.fov)),Object.assign(this.graphic,e);let{totalRay:t,fov:a,rayStep:r,texture:s,depth:i}=this.graphic},setPlayer:function(e){e.hasOwnProperty("angle")&&(e.angle=o(e.angle)),Object.assign(this.player,e),s(this.player,["x","y"],"player")}}},193:(e,t,a)=>{var r={"./control":681,"./control.js":681,"./render":963,"./render.js":963,"./run":465,"./run.js":465,"./set":902,"./set.js":902};function s(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=o,e.exports=s,s.id=193},140:(e,t,a)=>{const{toIndex:r}=a(162);function s(e,t,a,r){return"vertical"==r?t>e.xPos?"left":"right":"horizontal"==r?a>e.yPos?"top":"bottom":void 0}function o(e,t,a){return(Math.abs(e)+Math.abs(t))/a-Math.floor((Math.abs(e)+Math.abs(t))/a)}function i(e,t,a){return a.data[r(a.side,Math.floor(e/a.cellSize),Math.floor(t/a.cellSize))]}e.exports=e=>{let t=e.player.angle-e.graphic.fov/2,a=e.graphic.fov/e.graphic.totalRay,l=[],n=0;for(;n<e.graphic.totalRay;){let c,h,p=e.player.xPos,f=e.player.yPos,d=e.graphic.rayStep*Math.cos(t),u=e.graphic.rayStep*Math.sin(t),y=!1;for(;!y;){c=p+d,h=f+u;let t=i(c,f,e.map);0!=t&&(y=!0,l.push({distanceX:c,distanceY:h,face:s(e.player,c,h,"vertical"),texturePos:o(f,u,e.map.cellSize),blockId:t})),t=e.map.data[r(e.map.side,Math.floor(p/e.map.cellSize),Math.floor(h/e.map.cellSize))],0!=t&&(y=!0,l.push({distanceX:c,distanceY:h,face:s(e.player,c,h,"horizontal"),texturePos:o(p,d,e.map.cellSize),blockId:t})),p+=d,f+=u,(p<0||p>e.map.side*e.map.cellSize)&&(y=!0),(f<0||f>e.map.side*e.map.cellSize)&&(y=!0)}t+=a,n++}return l}},848:e=>{e.exports=e=>{Object.entries(e.map.block).forEach((t=>{Array.isArray(t[1].texture)||(t[1].texture=[t[1].texture,t[1].texture,t[1].texture,t[1].texture]),e.texture.data[t[0]]={},t[1].texture.forEach(((a,r)=>{let s,o,i=!1;/\.(jpg||jpeg||png)$/g.test(a)?(o="image",s=new Image,s.src=a,/\.png$/g.test(a)&&(i=!0)):(o="colour",s=a),e.texture.data[t[0]][["left","top","right","bottom"][r]]={type:o,content:s,transparent:i}}))}))}},325:(e,t,a)=>{const{toIndex:r}=a(162);e.exports={moveX:function(e,t){let a=t>0?e.player.size/6:-e.player.size/6;0==e.map.data[r(e.map.side,Math.floor(e.player.x+t+a),Math.floor(e.player.y+a))]&&(e.player.x+=t)},moveY:function(e,t){let a=t>0?e.player.size/6:-e.player.size/6;0==e.map.data[r(e.map.side,Math.floor(e.player.x+a),Math.floor(e.player.y+t+a))]&&(e.player.y+=t)}}},629:e=>{e.exports=function(e,t,a,r){let s=a.width/e.graphic.totalRay;r.fillStyle="skyblue",r.fillRect(0,0,a.width,a.height),r.fillStyle="gray",r.fillRect(0,a.height/2,a.width,a.height/2),t.forEach(((t,o)=>{let i=Math.sqrt(Math.pow(t.distanceX-e.player.xPos,2)+Math.pow(t.distanceY-e.player.yPos,2))/10;0==i&&(i=.1);let l=10*i/e.map.distance,n=s*o,c=a.height/2-a.height/i/2,h=a.height/i,p=e.texture.data[t.blockId][t.face];if(e.graphic.texture){if("image"==p.type){"right"==t.face&&(t.texturePos=1-t.texturePos),"top"==t.face&&(t.texturePos=1-t.texturePos);let e=t.texturePos*p.content.width;r.drawImage(p.content,e,0,s/p.content.width,p.content.height,n,c,s,h)}else r.fillStyle=p.content,r.fillRect(n,c,s,h);e.graphic.depth&&(l*=50,r.fillStyle="right"==t.face||"left"==t.face?"rgba(65,65,65,"+l+"%)":"rgba(0,0,0,"+l+"%)",r.fillRect(n,c,s,h))}else l=50-25*l,r.fillStyle=e.graphic.depth?"right"==t.face||"left"==t.face?"hsl(240, 100%, "+l+"%)":"hsl(240, 70%, "+l+"%)":"right"==t.face||"left"==t.face?"hsl(240, 100%, 50%)":"hsl(240, 70%, 50%)",r.fillRect(n,c,s,h)}))}},162:e=>{e.exports={toRadian:e=>e*Math.PI/180,assign:(e,t,a)=>Object.entries(a).forEach((a=>e[t][a[0]]=a[1])),validate:(e,t,a)=>{t.forEach((t=>{if(!e.hasOwnProperty(t))throw new Error(`${a.charAt(0).toUpperCase()+a.slice(1)} must has "${t}" as the properties`)}))},toIndex:(e,t,a)=>a*e+t}}},t={};function a(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}return a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a(864)})()));