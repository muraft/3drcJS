!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Tdrc=e():t.Tdrc=e()}(self,(()=>(()=>{var t={692:t=>{t.exports=class{constructor(){this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.faceLeft=!1,this.faceRight=!1}keyboard(t="default"){"default"==t&&(window.onkeydown=t=>{switch(t.keyCode){case 37:case 65:buttons.left=!0;break;case 38:case 68:buttons.right=!0;break;case 39:case 87:buttons.forward=!0;break;case 40:case 83:buttons.backward=!0;break;case 81:buttons.faceLeft=!0;break;case 69:buttons.faceRight=!0}},window.onkeyup=t=>{switch(t.keyCode){case 37:case 65:buttons.left=!1;break;case 38:case 68:buttons.right=!1;break;case 39:case 87:buttons.forward=!1;break;case 40:case 83:buttons.backward=!1;break;case 81:buttons.faceLeft=!1;break;case 69:buttons.faceRight=!1}})}}},961:(t,e,a)=>{var o={"./Buttons":692,"./Buttons.js":692};function r(t){var e=s(t);return a(e)}function s(t){if(!a.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=s,t.exports=r,r.id=961},864:(t,e,a)=>{const{loadDefault:o,loadMethods:r,loadClasses:s}=a(330),i=a(848),{validate:l}=a(162);"undefined"!=typeof window?s(["Buttons"]):console.warn("[33m%s[0m","Application runned outside the browser, window is not found, the global class won't load"),t.exports=class{constructor(){o(this),r(this,["set","control","run","render","drawMap"])}init(){l(this.map,["data"],"map"),l(this.player,["x","y"],"player"),i(this)}}},599:(t,e,a)=>{const{toRadian:o}=a(162);t.exports={map:{blockWidth:5},texture:{color:"blue",data:{}},player:{size:1,angle:o(45),speed:.05},graphic:{totalRay:300,fov:o(45),rayStep:.05,texture:!0,depth:!0},rays:[],_deltaTime:0,fps:0,devMode:!1}},330:(t,e,a)=>{const o=a(599);t.exports={loadDefault:t=>Object.assign(t,o),loadMethods:(t,e)=>{e.forEach((e=>{const o=a(193)("./"+e);if("object"==typeof o)for(const e in o)t[e]=o[e];else t[e]=o}))},loadClasses:t=>{t.forEach((t=>window["Tdrc_"+t]=a(961)("./"+t)))}}},681:(t,e,a)=>{const{toRadian:o}=a(162),{moveX:r,moveY:s}=a(325);t.exports=function(t){if(t.left){let t=this.player.angle-o(90),e=this.player.speed*Math.cos(t),a=this.player.speed*Math.sin(t);r(this,e),s(this,a)}if(t.forward){let t=this.player.speed*Math.cos(this.player.angle),e=this.player.speed*Math.sin(this.player.angle);r(this,t),s(this,e)}if(t.right){let t=this.player.angle+o(90),e=this.player.speed*Math.cos(t),a=this.player.speed*Math.sin(t);r(this,e),s(this,a)}if(t.backward){let t=this.player.speed*Math.cos(this.player.angle),e=this.player.speed*Math.sin(this.player.angle);r(this,-t),s(this,-e)}t.faceLeft&&(this.player.angle-=o(1)),t.faceRight&&(this.player.angle+=o(1))}},312:t=>{t.exports=function(t,e,a,o){const r=o.getContext("2d");this.map.data.forEach(((o,s)=>{xPos=(t+s%this.map.width)*a,yPos=Math.floor(e+s/this.map.width)*a,r.fillStyle=0==o?"grey":"blue",r.fillRect(xPos,yPos,a,a)})),this.rays.forEach((t=>{r.strokeWidth=10,r.strokeStyle="yellow",r.beginPath(),r.moveTo(this.player.x*a,this.player.y*a);let e=a/this.map.blockWidth;r.lineTo(t.distanceX*e,t.distanceY*e),r.stroke(),r.closePath()})),r.fillStyle="red",r.beginPath(),r.arc(this.player.x*a,this.player.y*a,2,0,2*Math.PI),r.fill(),r.closePath()}},963:(t,e,a)=>{const o=a(140),r=a(629);t.exports=function(t){const e=t.getContext("2d");e.clearRect(0,0,t.width,t.height),this.player.xPos=this.player.x*this.map.blockWidth,this.player.yPos=this.player.y*this.map.blockWidth,this.rays=o(this),this.devMode&&console.log(this.rays),r(this,this.rays,t,e)}},465:t=>{let e,a,o;function r(){o=performance.now(),a(),e._deltaTime=performance.now()-o,e.fps=1e3/e._deltaTime,requestAnimationFrame(r)}t.exports=function(t){e=this,a=t,window.onload=()=>requestAnimationFrame(r)}},902:(t,e,a)=>{const{assign:o,validate:r,toRadian:s}=a(162);t.exports={setMap:function(t){Object.assign(this.map,t),r(this.map,["data"],"map");let e=Math.sqrt(this.map.data.length);if(e%1!=0)throw new Error("Only nÃ—n square map is supported");this.map.width=e,this.map.distance=this.map.width*this.map.blockWidth-2*this.map.blockWidth},setGraphic:function(t){t.hasOwnProperty("fov")&&(t.fov=s(t.fov)),Object.assign(this.graphic,t);let{totalRay:e,fov:a,rayStep:o,texture:r,depth:i}=this.graphic},setPlayer:function(t){t.hasOwnProperty("angle")&&(t.angle=s(t.angle)),Object.assign(this.player,t),r(this.player,["x","y"],"player")}}},193:(t,e,a)=>{var o={"./control":681,"./control.js":681,"./drawMap":312,"./drawMap.js":312,"./render":963,"./render.js":963,"./run":465,"./run.js":465,"./set":902,"./set.js":902};function r(t){var e=s(t);return a(e)}function s(t){if(!a.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=s,t.exports=r,r.id=193},140:(t,e,a)=>{const{toIndex:o}=a(162);function r(t,e,a,o){return"vertical"==o?e>t.xPos?"left":"right":"horizontal"==o?a>t.yPos?"top":"bottom":void 0}function s(t,e,a){return(Math.abs(t)+Math.abs(e))/a-Math.floor((Math.abs(t)+Math.abs(e))/a)}function i(t,e,a){return a.data[o(a.width,Math.floor(t/a.blockWidth),Math.floor(e/a.blockWidth))]}t.exports=t=>{let e=t.player.angle-t.graphic.fov/2,a=t.graphic.fov/t.graphic.totalRay,l=[],h=0;for(;h<t.graphic.totalRay;){let n,c,p=t.player.xPos,d=t.player.yPos,f=t.graphic.rayStep*Math.cos(e),y=t.graphic.rayStep*Math.sin(e),u=!1;for(;!u;){n=p+f,c=d+y;let e=i(n,d,t.map);0!=e&&(u=!0,l.push({distanceX:n,distanceY:c,face:r(t.player,n,c,"vertical"),texturePos:s(d,y,t.map.blockWidth),blockId:e})),e=t.map.data[o(t.map.width,Math.floor(p/t.map.blockWidth),Math.floor(c/t.map.blockWidth))],0!=e&&(u=!0,l.push({distanceX:n,distanceY:c,face:r(t.player,n,c,"horizontal"),texturePos:s(p,f,t.map.blockWidth),blockId:e})),p+=f,d+=y,(p<0||p>t.map.width*t.map.blockWidth)&&(u=!0),(d<0||d>t.map.width*t.map.blockWidth)&&(u=!0)}e+=a,h++}return l}},848:t=>{t.exports=t=>{Object.entries(t.map.block).forEach((e=>{Array.isArray(e[1].texture)||(e[1].texture=[e[1].texture,e[1].texture,e[1].texture,e[1].texture]),t.texture.data[e[0]]={},e[1].texture.forEach(((a,o)=>{let r,s,i=!1;/\.(jpg||jpeg||png)$/g.test(a)?(s="image",r=new Image,r.src=a,/\.png$/g.test(a)&&(i=!0)):(s="color",r=a),t.texture.data[e[0]][["left","top","right","bottom"][o]]={type:s,content:r,transparent:i}}))}))}},325:(t,e,a)=>{const{toIndex:o}=a(162);t.exports={moveX:function(t,e){let a=e>0?t.player.size/6:-t.player.size/6;0==t.map.data[o(t.map.width,Math.floor(t.player.x+e+a),Math.floor(t.player.y+a))]&&(t.player.x+=e)},moveY:function(t,e){let a=e>0?t.player.size/6:-t.player.size/6;0==t.map.data[o(t.map.width,Math.floor(t.player.x+a),Math.floor(t.player.y+e+a))]&&(t.player.y+=e)}}},629:t=>{t.exports=function(t,e,a,o){let r=a.width/t.graphic.totalRay;o.fillStyle="skyblue",o.fillRect(0,0,a.width,a.height),o.fillStyle="gray",o.fillRect(0,a.height/2,a.width,a.height/2),e.forEach(((e,s)=>{let i=Math.sqrt(Math.pow(e.distanceX-t.player.xPos,2)+Math.pow(e.distanceY-t.player.yPos,2))/10;0==i&&(i=.1);let l=10*i/t.map.distance,h=r*s,n=a.height/2-a.height/i/2,c=a.height/i,p=t.texture.data[e.blockId][e.face];if(t.graphic.texture){if("image"==p.type){"right"==e.face&&(e.texturePos=1-e.texturePos),"top"==e.face&&(e.texturePos=1-e.texturePos);let t=e.texturePos*p.content.width;o.drawImage(p.content,t,0,r/p.content.width,p.content.height,h,n,r,c)}else o.fillStyle=p.content,o.fillRect(h,n,r,c);t.graphic.depth&&(l*=50,o.fillStyle="right"==e.face||"left"==e.face?"rgba(65,65,65,"+l+"%)":"rgba(0,0,0,"+l+"%)",o.fillRect(h,n,r,c))}else l=50-25*l,o.fillStyle=t.graphic.depth?"right"==e.face||"left"==e.face?"hsl(240, 100%, "+l+"%)":"hsl(240, 70%, "+l+"%)":"right"==e.face||"left"==e.face?"hsl(240, 100%, 50%)":"hsl(240, 70%, 50%)",o.fillRect(h,n,r,c)}))}},162:t=>{t.exports={toRadian:t=>t*Math.PI/180,assign:(t,e,a)=>Object.entries(a).forEach((a=>t[e][a[0]]=a[1])),validate:(t,e,a)=>{e.forEach((e=>{if(!t.hasOwnProperty(e))throw new Error(`${a.charAt(0).toUpperCase()+a.slice(1)} must has "${e}" as the properties`)}))},toIndex:(t,e,a)=>a*t+e}}},e={};function a(o){var r=e[o];if(void 0!==r)return r.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,a),s.exports}return a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a(864)})()));